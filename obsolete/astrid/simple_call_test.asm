; Generated by Astrid Pure Stack-Centric Compiler
; Architecture: Nova-16 with pure stack-first approach
; Variables stored on stack, minimal register usage
; Stack Layout: [locals][FP][return_addr][params]

ORG 0x0046

get_constant:
    PUSH FP                       ; Save caller's frame pointer
    MOV FP, SP                    ; Set new frame pointer
    SUB SP, 4      ; Allocate 4 bytes for locals
    MOV P0, FP                ; Load base pointer
    SUB P0, 4              ; Subtract for negative offset (-4)
    MOV R0, 42         ; Load constant 42
    MOV [P0], R0                  ; Store to local variable v0
    MOV P0, FP                ; Load base pointer
    SUB P0, 4              ; Subtract for negative offset (-4)
    MOV R0, [P0]                  ; Load return value v0
    MOV SP, FP                    ; Restore stack pointer
    POP FP                        ; Restore caller's frame pointer
    RET                           ; Return to caller

main:
    MOV SP, 0xF000                ; Initialize stack pointer to safe area
    MOV FP, SP                    ; Initialize frame pointer for main
    SUB SP, 6      ; Allocate 6 bytes for locals
    CALL get_constant          ; Call function
    MOV P0, FP                ; Load base pointer
    SUB P0, 4              ; Subtract for negative offset (-4)
    MOV [P0], R0                  ; Store return value to v1
    MOV P0, FP                ; Load base pointer
    SUB P0, 4              ; Subtract for negative offset (-4)
    MOV P2, [P0]                  ; Load from v1 (16-bit)
    MOV P1, FP                ; Load base pointer
    SUB P1, 6              ; Subtract for negative offset (-6)
    MOV [P1], P2                  ; Store to v2 (16-bit)
    ; Halt processor
    MOV SP, FP                    ; Restore stack pointer
    HLT                           ; Halt system
